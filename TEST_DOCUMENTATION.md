# 応募者情報提出シート作成用フォーム テスト実行手順書

## 概要
株式会社ナガセ応募者情報提出シート作成用フォーム（`oop.html`）のテスト実行手順書です。
このフォームは **バリデーション → 確認画面 → CSV出力** の流れに特化した設計となっています。

## 1. テスト観点マトリクス

| 機能ブロック | 主なテスト観点 | 代表KPI/カバレージ指標 |
|-------------|---------------|---------------------|
| **入力バリデーション** | 必須項目、正規表現、口座名義人一致、電話番号相互チェック、フリガナ正規化 | **バリデーションルールカバレージ 100%** |
| **エラー表示** | エラーメッセージ表示、クラス付与、リアルタイム検証 | **エラーメッセージカバレージ 100%** |
| **学歴による表示制御** | 動的フィールド表示/非表示、自動値入力 | **学歴パターンカバレージ 100%** |
| **確認画面遷移** | 入力値保持、戻るボタン、データ整合性 | **ユーザーフローカバレージ ≥ 90%** |
| **CSV生成** | UTF-8 BOM、エスケープ処理、ファイル名生成、ダウンロード注意メッセージ | **CSVシナリオカバレージ 100%** |
| **非機能** | レスポンシブ、アクセシビリティ、郵便番号API | Lighthouse スコア & 操作遅延 |

## 2. レイヤ別テスト戦略

### 2-1. 手動テスト（ブラウザ）

#### A. バリデーション機能テスト

**実行手順：**
1. ブラウザで`oop.html`を開く
2. 各入力フィールドに対して以下のテストケースを実行
3. エラー表示とクリア動作を確認

| フィールド | テストケース | 期待結果 |
|-----------|-------------|----------|
| 氏名（漢字） | 空欄で確認ボタン | 「この項目は必須です。」表示 |
| 氏名（カナ） | 「あいうえお」入力 | 自動で「ｱｲｳｴｵ」に変換 |
| 学部・学類・科類等 | 「理科一類」入力 | エラーなく受け入れられる |
| 郵便番号 | 「1234567」入力後住所検索 | 住所自動入力確認 |
| 電話番号（自宅・携帯） | 両方空欄 | 「いずれかは必須」エラー |
| 口座名義人 | 氏名と不一致 | 「必ず応募者本人名義の口座を入力してください」 |
| 口座名義人フリガナ | 「ﾄｳｼﾝﾀﾛｩ」（小文字含む） | 「ﾄｳｼﾝﾀﾛｳ」と一致判定される |
| 東進在籍歴 | 未選択で確認ボタン | 「いずれかの選択肢を選択してください」 |

**カバレージ確認ポイント：**
- [x] 全必須項目で空欄エラーが表示される
- [x] 正規表現バリデーション（郵便番号、電話番号、メール）
- [x] リアルタイム変換（カナ、数字）
- [x] 相互バリデーション（電話番号、口座名義人）
- [x] フリガナ正規化（小文字→大文字変換による一致判定）
- [x] 東進在籍歴のラジオボタン必須チェック

#### B. 学歴による表示制御テスト

**実行手順：**
1. 各学歴選択肢を順番に選択
2. 表示/非表示が切り替わることを確認
3. 自動入力値を確認(以下のスクリプトをブラウザのdevToolsのConsoleに貼り付けて実行)
```javaScript
document.querySelectorAll('input').forEach(input => {
  console.log(`name: ${input.name}, type: ${input.type}, value: ${input.value}`);
});
```
| 学歴選択 | 大学セクション | 出身高校 | 自動入力値 |
|----------|----------------|----------|------------|
| 1.大学・大学院 | 表示 | 表示 | なし |
| 2.短大・専門 | 非表示 | 表示 | 大学項目「なし」、日付「0001-01-01」 |
| 3.高校 | 非表示 | 表示 | 大学項目「なし」、日付「0001-01-01」 |
| 4.中学 | 非表示 | 非表示 | 大学項目「なし」、出身高校「なし」 |

**カバレージ確認ポイント：**
- [x] 4つの学歴パターンすべてで表示制御が正しく動作
- [x] 自動入力値が期待通りに設定される
- [x] 表示切り替え時のバリデーション状態が適切

#### C. 確認画面・CSV出力テスト

**実行手順：**
1. 全項目を正しく入力
   1. debug-scipt.jsのスクリプトをブラウザのdevToolsのConsoleに貼り付けて実行
   2. Consoleの指示に従ってtest_cases_minimum.csvを読み込ませる
   3. テストケースの値が自動入力される
2. 「入力内容を確認する」をクリック
3. 確認画面の表示内容を検証
4. 「CSVとして出力」をクリック
5. ダウンロードされたCSVファイルを検証

**確認画面チェックポイント：**
- [x] 入力値が正確に表示されている
- [x] 学歴に応じて非表示項目が確認画面に表示されない
- [x] 戻るボタンで入力値が保持される

### 2-2. CSV出力専用チェックリスト

| 観点 | チェック内容 | 検証方法 |
|------|-------------|----------|
| **文字エンコード** | UTF-8 BOM付き | テキストエディタで文字化けしない |
| **ファイル名** | `姓名_応募者情報提出シート.csv` | 氏名が正しく反映 |
| **ヘッダー行** | 項目名が1行目に出力 | Excelで開いて列名確認 |
| **データ行** | 入力値が2行目に出力 | 入力値との一致確認 |
| **エスケープ処理** | カンマ・改行・ダブルクォート | 特殊文字を含む値でテスト |
| **日付形式** | YYYY/MM/DD形式 | 「2024-12-25」→「2024/12/25」 |
| **学歴連動** | 非表示項目は出力されない | 各学歴パターンでCSV確認 |
| **東進在籍歴** | ラジオボタン選択値が正しく出力 | 2択の選択肢テキストが出力される |
| **ダウンロード注意** | 赤太字の警告メッセージ表示 | ダウンロード完了時に注意文言確認 |

**CSV内容検証例：**
```csv
"バージョン","作成日時","姓","名","学部・学類・科類等","東進在籍歴",...
"1.0.0","2024/12/25 15:30:00","東進","太郎","理学部","東進ハイスクール・東進衛星予備校・東大特進のいずれかに在籍歴がある",...
```

### 2-3. 非機能テスト

#### レスポンシブテスト
**実行手順：**
1. ブラウザの開発者ツールを開く
2. デバイスモードで以下の画面サイズをテスト
   - スマートフォン（375px）
   - タブレット（768px）
   - デスクトップ（1200px）

**確認ポイント：**
- [x] レイアウトが崩れない
- [x] ボタンがタップしやすいサイズ
- [x] テキストが読みやすい

#### ローカル環境アクセシビリティテスト
**実行手順：**
1. ブラウザの開発者ツール > Elements を開く
2. 各入力フィールドのHTML属性を確認
3. キーボードのみでフォーム操作をテスト

**確認ポイント：**
- [x] 必須項目にaria-required属性またはrequired属性
- [x] エラーメッセージとフィールドの関連付け（aria-describedby）
- [x] キーボードナビゲーション（Tabキーでの移動）
- [x] ラジオボタン・チェックボックスのキーボード操作
- [x] フォーカス表示の視認性

#### パフォーマンステスト
**確認ポイント：**
- [x] ページ読み込み時間 < 2秒
- [x] 郵便番号検索レスポンス < 3秒
- [x] CSV生成処理 < 1秒

#### ローカル環境互換性テスト
**実行手順：**
1. インターネット接続を切断
2. ファイルをダブルクリックで開く
3. 各機能が正常に動作することを確認

**確認ポイント：**
- [x] インターネット接続なしで動作する
- [x] 外部CDNやライブラリへの依存がない
- [x] 郵便番号検索APIが利用できない場合の適切な処理
- [x] ファイルをダブルクリックで開ける
- [x] 保存したCSVファイルが文字化けしない

#### ブラウザ互換性テスト
**実行手順：**
1. 各ブラウザでファイルを開く
2. ~~古いブラウザバージョンでも動作することを確認~~

**確認ポイント：**
- [x] Chrome（最新版）
- [ ] Firefox（最新版）
- [ ] Safari（最新版）
- [x] Edge（最新版）
- [ ] ~~Internet Explorer 11（可能な場合）~~
- [x] JavaScript無効環境での代替表示
- [ ] ~~ES6+機能を使用していない~~
- [x] CSS Flexboxの対応状況

#### セキュリティ・エラーハンドリングテスト
**確認ポイント：**
- [x] ローカルファイルでのCORS制限がない(zipcloudなので問題なし)
- [x] ファイルシステムアクセスの制限を考慮
- [x] ネットワークエラー時の適切な処理
- [x] ファイル保存失敗時のユーザー案内

## 3. テストケース実行

### 3-1. 基本テストケース（`test_cases.csv`利用）

**実行手順：**
1. `test_cases.csv`を開く
2. TC001から順番に以下の手順でテスト

**テスト実行フロー：**
```
1. ブラウザでoop.htmlを開く
2. test_cases.csvの1行分のデータを手動入力
3. 「入力内容を確認する」をクリック
4. バリデーション結果を確認
   - エラーの場合：期待エラーメッセージと一致するか
   - 成功の場合：確認画面に進むか
5. 確認画面でデータ内容を検証
6. CSVダウンロード後、ファイル内容を確認
7. 次のテストケースへ
```

### 3-2. エラーケース集中テスト

| 分類 | テスト内容 | 実行方法 |
|------|-----------|----------|
| 必須項目 | 各必須フィールドを1つずつ空欄にしてテスト | 必須項目 × 1回ずつ |
| フォーマット | 不正な形式で入力 | 郵便番号「123」、メール「invalid」等 |
| 一致チェック | 口座名義人を氏名と異なる値にする | 複数パターンで検証 |
| 文字変換 | ひらがな→カタカナ変換 | リアルタイム変換の確認 |
| フリガナ正規化 | 小文字カタカナで入力して一致確認 | 「ﾄｳｼﾝﾀﾛｩ」→「ﾄｳｼﾝﾀﾛｳ」で一致 |
| 東進在籍歴 | ラジオボタン未選択でバリデーション | 必須チェックの動作確認 |

### 3-3. 境界値テスト

| フィールド | 境界値 | 期待結果 |
|-----------|-------|----------|
| 郵便番号 | 6桁/7桁/8桁 | 7桁のみ受付 |
| 銀行コード | 3桁/4桁/5桁 | 4桁のみ受付 |
| 支店コード | 2桁/3桁/4桁 | 3桁のみ受付 |

## 4. テスト実行環境

### 対象ブラウザ
- [x] Chrome（最新版）
- [ ] Firefox（最新版）
- [ ] Safari（最新版）
- [x] Edge（最新版）
- [ ] ~~Internet Explorer 11~~（jsのES6以降が必須なので非対応）

### 実行前準備
1. ブラウザキャッシュをクリア
2. JavaScript有効化確認
3. ダウンロード設定確認
4. 開発者ツールのコンソールを開いてエラー監視
5. インターネット接続の有無を確認
6. ローカルファイルとして開くことを確認

## 5. テスト結果記録

### 合格基準
- [ ] バリデーションルールカバレージ 100%
- [ ] 学歴パターンカバレージ 100%  
- [ ] CSVシナリオカバレージ 100%
- [ ] 対象ブラウザでの動作確認 100%
- [ ] ローカル環境でのアクセシビリティ確認完了
- [ ] ローカル環境互換性確認完了
- [ ] ブラウザ互換性確認完了
- [ ] セキュリティ・エラーハンドリング確認完了

### 不具合記録テンプレート
```
■ 不具合ID: BUG-001
■ 発見日時: 2024/XX/XX XX:XX
■ 環境: Chrome 120.0.0.0 / Windows 11
■ 再現手順:
  1. XXXフィールドにYYYを入力
  2. ZZZボタンをクリック
■ 期待結果: AAA
■ 実際結果: BBB
■ 重要度: High/Medium/Low
```

## 6. 継続的改善

### 月次レビュー項目
- テストケースの実行時間短縮
- 新しいブラウザバージョンでの動作確認
- ユーザビリティ向上提案
- セキュリティ観点の強化

### 自動化推奨項目
- バリデーション機能の単体テスト
- CSV出力形式の検証
- ローカル環境でのアクセシビリティチェック
- 複数ブラウザでの動作確認

## 関連ファイル
- `kakomonf/oop.html` - メインフォームファイル  
- `kakomonf/test_cases.csv` - テストケースデータ
- `kakomonf/TEST_DOCUMENTATION.md` - 本ドキュメント

## 更新履歴
- 2024-12-XX: 初版作成（分岐網羅テスト対応）
- 2024-12-XX: 実行手順書として全面改良（機能別・レイヤ別戦略追加） 